/* 
 * x10.js v0.0.1 
 * Web worker wrapper with simple interface 
 * 
 * Copyright (c) 2013-2015, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the MIT License 
 */ 
!function(a,b){var c={init:function(){return this},work_handler:function(a){var b=Array.prototype.slice.call(a.data,1),c=a.data[0],d=tree[c].call(tree,b);postMessage(d)},get_worker:function(b){var d=a.URL||a.webkitURL,e=new Blob([b+'self.addEventListener("message", '+this.work_handler.toString()+", false);"],{type:"text/javascript"}),f=new Worker(d.createObjectURL(e));return f.onmessage=function(a){c.observer.emit("x10:find",a.data)},f},compile:function(a){var b="var tree = {"+this.parse(a).join(",")+"};",d=this.get_worker(b),e={};return e.find=function(){var a=Array.prototype.slice.call(arguments,0,-1),b=arguments[arguments.length-1],e="find";console.log(d),a.unshift(e),c.observer.on("x10:"+e,function(a){b(a.detail)}),d.postMessage(a)},e},parse:function(a,c){var d,e,f,g=[];for(d in a)if(f=a[d],null!==f)if(f!==b){switch(f.constructor){case Date:e="new Date("+f.valueOf()+")";break;case Object:e="{"+this.parse(f).join(",")+"}";break;case Array:e="["+this.parse(f,!0).join(",")+"]";break;case String:e='"'+f.replace(/"/g,'\\"')+'"';break;case Function:e=f.toString();break;default:e=f}g.push(c?e:d+":"+e)}else g.push(d+":undefined");else g.push(d+":null");return g},observer:function(){var a={};return{on:function(b,c){a[b]||(a[b]=[]),a[b].unshift(c)},off:function(b,c){if(a[b]){var d=a[b].indexOf(c);a[b].splice(d,1)}},emit:function(b,c){if(a[b])for(var d={type:b,detail:c,isCanceled:!1,cancelBubble:function(){this.isCanceled=!0}},e=a[b].length;e--;){if(d.isCanceled)return;a[b][e](d)}}}}()};a.x10=c.init()}(window);